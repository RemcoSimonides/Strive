<ion-header mode="md">
	<ion-toolbar>

		<ion-buttons slot="end">
			<ion-button (click)="dismiss()">
				<ion-icon slot="icon-only" name="close"></ion-icon>
			</ion-button>
		</ion-buttons>
		
	</ion-toolbar>
</ion-header>

<ng-container *ngIf="stakeholder$ | async as stakeholder">
	<ng-container *ngIf="stakeholder.isAdmin || stakeholder.isAchiever || stakeholder.isSupporter else noAccess">
		<ion-content [scrollEvents]="true" (ionScroll)="logScrolling($event)">
			<ul>
				<ion-infinite-scroll position="top" threshold="100px" (ionInfinite)="more($event)" [disabled]="done$ | async">
					<ion-infinite-scroll-content
						loadingSpinner="bubbles"
						loadingText="Loading more data...">
					</ion-infinite-scroll-content>
				</ion-infinite-scroll>
				
				<li *ngFor="let comment of comments$ | async">
					<img [ref]="comment.user?.photoURL" asset="profile.png" [width]="40" [height]="40"/>
					<article>
						<small><b>{{ comment.user?.username }}</b></small>
						<small class="date">{{ comment.createdAt | timeAgo }}</small>
						<div [innerHTML]="comment.text | toHTML"></div>
					</article>
				</li>
			</ul>
		</ion-content>
	
		<ion-footer>
			<ion-item>
				<ion-textarea type="text" placeholder="Reply..." [formControl]="form" (keydown.enter)="addReply($event)" autoGrow autocapitalize="sentences"></ion-textarea>
				<ion-icon name="send" (click)="addReply()"></ion-icon>
			</ion-item>
		</ion-footer>
	</ng-container>

	<ng-template #noAccess>
		<section>
			<p>In order to chat, you need to</p>
			<goal-join-button [goal]="goal" [stakeholder]="stakeholder"></goal-join-button>
			<p>or</p>
			<ion-button (click)="support()" class="secondary">
				<ion-icon slot="start" src="assets/icons/hand-holding-heart-solid.svg"></ion-icon>
				<span>Support</span>
			</ion-button>
		</section>
	</ng-template>
</ng-container>
