<strive-header-modal (dismiss)="dismiss()" />

<ion-content class="ion-padding" *ngIf="question">

  <main>
    <h3>{{ question.question | replaceFrequency: question.frequency }}</h3>

    <form [formGroup]="form">
      <ion-list mode="md">
        <ion-item lines="none">
          <ion-select formControlName="frequency" interface="popover" label="How often would you like to recieve this question?" labelPlacement="stacked">
            <ion-select-option value="weekly">Weekly</ion-select-option>
            <ion-select-option value="monthly">Monthly</ion-select-option>
            <ion-select-option value="quarterly">Quarterly</ion-select-option>
            <ion-select-option value="yearly">Yearly</ion-select-option>
            <ion-select-option value="never">Turn off for now</ion-select-option>
          </ion-select>
        </ion-item>
      </ion-list>
    </form>

    <section>
      <h5>Entries</h5>
      <ng-container *ngIf="entries.length else noEntries">
        <ng-container [ngSwitch]="question.key">
          <ng-container *ngSwitchCase="'wheelOfLife'">
            <strive-wheel-of-life-results [entries]="wheelOfLifeEntries$ | async" />
          </ng-container>

          <ng-container *ngSwitchCase="'prioritizeGoals'">
            <article>
              <ng-container *ngIf="range.length > 1">
                <div>
                  <small>Today</small>
                  <small>{{ range[range.length - 1].date | date: 'M/yy' }}</small>
                </div>
                <ion-range [formControl]="rangeForm" [max]="range.length - 1" pin [pinFormatter]="pinFormatter()" mode="md"></ion-range>
              </ng-container>
              <strive-self-reflect-prioritize-goals [entry]="prioritizeGoalEntry()" />
            </article>
          </ng-container>

          <ng-container *ngSwitchDefault>
            <ng-container *ngFor="let entry of entries">

              <ng-container [ngSwitch]="question.key">
                <ng-container *ngIf="question.type === 'textarea'">

                  <ion-list mode="md" lines="none">
                    <b>{{ entry.createdAt | date:'longDate'}}</b>
                    <ion-item>{{ entry[question.key] }}</ion-item>
                  </ion-list>

                </ng-container>
                <ng-container *ngIf="question.type === 'formlist'">

                  <ion-list mode="md">
                    <small>{{ entry.createdAt | date:'longDate'}}</small>
                    <ion-item *ngFor="let item of entry[question.key]; let last = last" [lines]="last ? 'none' : 'full'">
                      {{ item }}
                    </ion-item>
                  </ion-list>

                </ng-container>
              </ng-container>

            </ng-container>
          </ng-container>
        </ng-container>
      </ng-container>
    </section>
  </main>
</ion-content>

<ng-template #noEntries>
  <small>No entries yet</small>
</ng-template>