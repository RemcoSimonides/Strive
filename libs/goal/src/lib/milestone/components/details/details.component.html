<ion-content>
  <form [formGroup]="form">
    <ion-item class="main">
      <strive-milestone-status [goal]="goal" [milestone]="milestone" [isAdmin]="isAdmin" [isAchiever]="isAchiever"></strive-milestone-status>
      <ion-textarea autoGrow [readonly]="!isAdmin" formControlName="content" placeholder="Type milestone"></ion-textarea>
      <ion-button *ngIf="canEdit" fill="clear" slot="end" (click)="deleteMilestone()">
        <ion-icon slot="icon-only" name="trash"></ion-icon>
      </ion-button>
    </ion-item>
  </form>

  <section fxLayout="column" fxLayoutGap="8px" class="ion-padding">
    <article fxLayout>
      <b>Deadline:</b>
      <strive-milestone-deadline [milestone]="milestone" [isAdmin]="isAdmin" (deadlineChange)="updateDeadline($event)"></strive-milestone-deadline>
    </article>
    
    <ng-container *ngIf="goal.numberOfAchievers > 1">
      <div fxLayout fxLayoutGap="8px">
        <b>Assignee:</b>
        <ng-container *ngIf="milestone.achiever.uid else empty">
          <goal-milestone-assignee [achiever]="milestone.achiever" (click)="toggleAssignMe()" class="clickable"></goal-milestone-assignee>
        </ng-container>
        <ng-template #empty>
          <i (click)="toggleAssignMe()" class="clickable">No one - Assign me</i>
        </ng-template>
      </div>
    </ng-container>

    <div fxLayout="row wrap" fxLayoutAlign="space-between">
      <span><b>Supports: </b>{{ milestone.numberOfCustomSupports }}</span>

      <ion-button (click)="openSupportModal()" color="secondary" fill="outline">
        <ion-icon slot="start" src="assets/icons/hand-holding-heart-solid.svg"></ion-icon>
        <span>{{ milestone.status === 'pending' ? 'SUPPORT' : 'SHOW SUPPORTS'}}</span>
      </ion-button>
    </div>

    <ng-container *ngIf="isAdmin || milestone.subtasks?.length">
      <h5>Subtasks ({{ form.subtasks.value | subtasksCompleted}})</h5>
      <ion-list mode="md">
        <ion-item *ngFor="let control of form.subtasks.controls; let i = index">
          <ion-button fill="clear" (click)="toggleSubtask(i)">
            <ion-icon  slot="icon-only"
              [name]="control.completed.value ? 'checkmark-circle' : 'radio-button-off'"
              color="primary">
            </ion-icon>
          </ion-button>
          <ion-input [readonly]="!isAdmin" [formControl]="control.content"></ion-input>
        </ion-item>
        <form [formGroup]="subtaskForm" *ngIf="isAdmin">
          <ion-item>
            <ion-icon class="icon" name="radio-button-off" color="primary"></ion-icon>
            <ion-input formControlName="content" placeholder="Add subtask" (keydown.enter)="addSubtask()"></ion-input>
            <ion-button (click)="addSubtask()">add</ion-button>
          </ion-item>
        </form>
      </ion-list>
    </ng-container>

    <!-- <small><b>Created at:</b> {{ milestone.createdAt | date:'longDate' }}</small>
    <small *ngIf="milestone.finishedAt">
      <b>Finished at:</b> {{ milestone.finishedAt | date:'longDate' }}
    </small> -->

  </section>
</ion-content>

