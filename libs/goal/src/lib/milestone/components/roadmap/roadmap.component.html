<ng-container *ngIf="milestones else loading">
  <ng-container *ngIf="milestones.length || isAdmin else empty">
    <ion-list mode="md">
      <ion-reorder-group [disabled]="!isAdmin" (ionItemReorder)="doReorder($event)">
        <ion-item *ngFor="let milestone of milestones; trackBy: trackByFn" (click)="openDetails(milestone)" button class="milestone" [ngClass]="{'no-padding': !createMode}">
          <strive-milestone-status *ngIf="!createMode" [milestone]="milestone" [goal]="goal" [isAdmin]="isAdmin" [isAchiever]="isAchiever"></strive-milestone-status>
          <section fxLayout="column">
            {{ milestone.content }}
            <article fxLayout="row wrap" fxLayoutAlign="start center" fxLayoutGap="16px">
              <ng-container *ngIf="milestone.deadline">
                <strive-milestone-deadline
                  [milestone]="milestone"
                  [isAdmin]="isAdmin">
                </strive-milestone-deadline>
              </ng-container>
              <ng-container *ngIf="milestone.achiever.uid">
                <goal-milestone-assignee [achiever]="milestone.achiever"></goal-milestone-assignee>
              </ng-container>
              <ng-container *ngIf="milestone.subtasks?.length">
                <div class="subtasks">
                  <ion-icon name="list-outline"></ion-icon><small>{{ milestone.subtasks | subtasksCompleted }}</small>
                </div>
              </ng-container>
            </article>
          </section>
          <ng-container *ngIf="!createMode">
            <ion-button slot="end" size="small" [disabled]="milestone.status !== 'pending'" (click)="openSupportModal($event, milestone)">{{ milestone.numberOfCustomSupports }}
              <ion-icon src="assets/icons/hand-holding-heart-solid.svg" slot="end"></ion-icon>
            </ion-button>
          </ng-container>
          <ion-reorder slot="end"></ion-reorder>
        </ion-item>
      </ion-reorder-group>
      
      <form [formGroup]="milestoneForm" *ngIf="isAdmin">
        <ion-item lines="inset" [ngClass]="{'no-padding': !createMode}">
          <strive-milestone-status *ngIf="!createMode" status="pending"></strive-milestone-status>
          <ion-input formControlName="content" placeholder="Add milestone" (keydown.enter)="add()"></ion-input>
          <ion-button (click)="add()">add</ion-button>
        </ion-item>
      </form>
    </ion-list>
  </ng-container>
</ng-container>

<ng-template #empty>
  <section fxLayout="column" fxLayoutAlign="center center" class="empty">
    <img asset='define_roadmap.png'/>
    <h3>Roadmap is not defined</h3>
  </section>
</ng-template>

<ng-template #loading>
  <section fxLayout fxLayoutAlign="center center">
    <ion-spinner name="lines" color="primary"></ion-spinner>
  </section>
</ng-template>