<ion-header mode="md">
  <ion-toolbar color="primary">

    <ion-buttons slot="end">
      <ion-button (click)="dismiss()">
        <ion-icon slot="icon-only" name="close"></ion-icon>
      </ion-button>
    </ion-buttons>

    <ion-title>{{ mode === 'create' ? 'Create' : 'Update' }} Post</ion-title>

  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ng-container *ngIf="mode === 'create'">
    <p><small>Create a memory for a lifetime. Someday you'll look back at your goals and see this post.</small></p>
  </ng-container>

  <form [formGroup]="postForm">

    <ng-container *ngIf="postForm.youtubeId.valueChanges | async as id; else notYoutube">
      <iframe
        height="300"
        [src]="('https://www.youtube-nocookie.com/embed/' + id) | safe:'resourceUrl'"
        title="YouTube video player"
        frameborder="0"
        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
        allowfullscreen
      ></iframe>
    </ng-container>

    <ng-template #notYoutube>
      <strive-image-selector
        [form]="postForm.get('mediaURL')"
        [storagePath]="'goals/' + post.goalId + '/posts/' + post.id">
      </strive-image-selector>
    </ng-template>

    <ion-list mode="md" lines="full">
      <ion-item>
        <ion-label color="primary" stacked>Description</ion-label>
        <ion-textarea autoGrow formControlName="description" placeholder="..." autocapitalize="sentences"></ion-textarea>
      </ion-item>

      <ion-item>
        <ion-label color="primary" stacked>
          <ion-icon name="calendar-outline"></ion-icon>
        </ion-label>
        <ion-input (ionFocus)="openDatePicker()" placeholder="Date" [value]="postForm.date.value | date:'longDate'"></ion-input>
      </ion-item>

      <ion-item lines="none">
        <ion-label color="primary" stacked>
          <ion-icon name="link-outline"></ion-icon>
        </ion-label>
        <ion-input formControlName="url" type="url" placeholder="Link (youtube, strava, etc..)"></ion-input>
        <ion-spinner *ngIf="scrapingUrl" slot="end" name="bubbles" color="primary"></ion-spinner>
      </ion-item>
    </ion-list>
  </form>

</ion-content>

<ion-footer class="ion-no-border">
  <ion-toolbar>
    <ion-buttons slot="end">
      <ion-button [disabled]="postForm.pristine || postForm.isEmpty" (click)="submitPost()" fill="clear" color="primary">{{ mode === 'create' ? 'Submit to Story' : 'Save changes' }}</ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-footer>
