<ion-list *ngIf="goal" mode="md">
  <ion-item lines="none" *ngIf="goal.supports.length && goalDescription">
    <ion-label>
      <ng-container [ngTemplateOutlet]="goalDescription" [ngTemplateOutletContext]="{ $implicit: goal }"></ng-container>
      <ng-template [ngTemplateOutlet]="goalStatus" [ngTemplateOutletContext]="{ $implicit: goal }"></ng-template>
    </ion-label>
  </ion-item>

  <ng-container *ngFor="let support of goal.supports; let lastGoalSupport = last; trackBy: trackBySupport">
    <article *ngIf="support.needsDecision">
      <small>Goal has been finished. Decide to give support or not.</small>
      <support-decision [support]="support"></support-decision>
    </article>
    <ion-item [lines]="!goal.milestones.length && lastGoalSupport ? 'none' : 'inset'" button [disabled]="support.status !== 'open'">
      <support-pledge [support]="support"></support-pledge>
    </ion-item>
  </ng-container>

  <ng-container *ngFor="let milestone of goal.milestones; let lastMilestone = last">
    <ion-item lines="none" *ngIf="milestoneDescription">
      <ion-label>
        <ng-container [ngTemplateOutlet]="milestoneDescription" [ngTemplateOutletContext]="{ $implicit: goal, milestone: milestone }"></ng-container>
        <ng-template [ngTemplateOutlet]="milestoneStatus" [ngTemplateOutletContext]="{ $implicit: milestone }"></ng-template>
      </ion-label>
    </ion-item>
    <ng-container *ngFor="let support of milestone.supports; let lastMilestoneSupport = last; ; trackBy: trackBySupport">
      <article *ngIf="support.needsDecision">
        <small>Milestone has been completed {{ milestone.status === 'succeeded' ? 'successfully' : 'unsuccessfully'}}. Decide to give support or not.</small>
        <support-decision [support]="support"></support-decision>
      </article>

      <ion-item [lines]="lastMilestone && lastMilestoneSupport ? 'none' : 'inset'" button [disabled]="support.status !== 'open'">
        <support-pledge [support]="support"></support-pledge>
      </ion-item>
    </ng-container>
  </ng-container>
</ion-list>