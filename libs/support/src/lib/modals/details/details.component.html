<ion-header mode="md">
  <ion-toolbar>
    <ion-buttons slot="end">
      <ion-button (click)="dismiss()" color="primary">
        <ion-icon slot="icon-only" name="close-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content *ngIf="support" class="ion-padding">

  <main>
    <article *ngIf="support.needsDecision" class="decision">
      <small *ngIf="!support.milestone">Goal has been finished. Decide to give support or not.</small>
      <small *ngIf="support.milestone">Milestone has been completed {{ support.milestone.status === 'succeeded' ? 'successfully' : 'unsuccessfully'}}. Decide to give support or not.</small>
      <support-decision [support]="support"></support-decision>
    </article>

    <support-pledge [support]="support"></support-pledge>

    <section class="details">

      <small class="status">
        <span class="gray">Status: </span>
        <ng-container *ngIf="support.status === 'open' && !support.needsDecision">
          <span *ngIf="!support.milestone">Waiting for goal '{{ support.goal.title }}' to be finished</span>
          <span *ngIf="support.milestone">Waiting for milestone '{{ support.milestone.content }}' of goal '{{ support.goal.title }}' to be completed</span>
        </ng-container>

        <ng-container *ngIf="support.status === 'open' && support.needsDecision">
          <span>Decide whether to give the support or not</span>
        </ng-container>

        <ng-container *ngIf="support.status === 'waiting_to_be_paid'">
          <span>Support should have been given to '{{ support.recipient.username }}'</span>
        </ng-container>

        <ng-container *ngIf="support.status === 'rejected'">
          <span>Supporter decided not to give the support</span>
        </ng-container>
        
      </small>
      <small class="gray">Supporter: {{ support.supporter.username }}</small>
      <small class="gray">Recipient: {{ support.recipient.username }}</small>
      <small class="gray">Created: {{ support.createdAt | date: 'longDate' }}</small>
    </section>

    <section class="actions">
      <ng-container *ngIf="support.status === 'open'">
        <ion-button (click)="give()" class="secondary" expand="block">
          <span>Give to {{ support.recipient.username }}</span>
        </ion-button>
        <ion-button (click)="remove()" class="danger" expand="block">
          Remove Support
        </ion-button>
      </ng-container>
    </section>

  </main>

</ion-content>