<header>
  <ion-icon name="sparkles-outline" color="secondary" />
  <h5>Suggestion</h5>
</header>

<main>
  <ng-container *ngIf="fetching$ | async; else suggestion">
    <p>Generating suggestion{{ thinking$ | async }}</p>
  </ng-container>

  <ng-template #suggestion>

    <ng-container *ngIf="suggestion$ | async as suggestion">
      <ng-container *ngIf="suggestion.status === 'waiting'">
        <p>Generating suggestion{{ thinking$ | async }}</p>
      </ng-container>

      <ng-container *ngIf="suggestion.status === 'error'">
        <p>Something went wrong while generating a suggestion.</p>
      </ng-container>

      <ng-container *ngIf="suggestion.status === 'streaming' || suggestion.status === 'completed'">
        <ng-container *ngIf="suggestion.answerParsed.length; else noParsed">
          <ol>
            <li *ngFor="let milestone of suggestion.answerParsed">{{ milestone }}</li>
          </ol>

          <ng-container *ngIf="suggestion.status === 'completed'">
            <ion-button class="secondary" (click)="apply(suggestion.answerParsed)" [disabled]="added$ | async" class="fade">
              <ion-icon name="sparkles-outline" slot="start" color="secondary" />
              <span>USE SUGGESTION</span>
            </ion-button>
          </ng-container>
        </ng-container>

        <ng-template #noParsed>
          <article>{{ suggestion.answerRaw }}</article>
        </ng-template>

        <section *ngIf="questions.length > 0 && suggestion.status === 'completed'" class="fade">
          <p>Improve the suggestions by answering the following questions</p>
          <ion-list mode="md">
            <ng-container *ngFor="let question of questions; let last = last; let index = index">
              <ion-item lines="none">
                <ion-label color="secondary">
                  <small>{{ question.question }}</small>
                </ion-label>
              </ion-item>
              <ion-item [lines]="last ? 'none' : 'full'">
                <ion-input
                  [(ngModel)]="questions[index].answer"
                  type="text"
                  maxlength="222"
                ></ion-input>
              </ion-item>
            </ng-container>
          </ion-list>
          <ion-button class="secondary" (click)="submit()">Submit</ion-button>
        </section>

      </ng-container>
    </ng-container>
  </ng-template>
</main>
