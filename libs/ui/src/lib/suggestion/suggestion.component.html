<header>
  <ion-icon name="sparkles-outline" color="secondary" />
  <h5>Suggestion</h5>
</header>

<main>
  <ng-container *ngIf="view$ | async as view">

    <ng-container *ngIf="view.suggestions.length">
      <ol>
        <li *ngFor="let milestone of view.suggestions">{{ milestone }}</li>
      </ol>

      <ion-button class="secondary" (click)="apply(view.suggestions)" [disabled]="added$ | async">
        <ion-icon name="sparkles-outline" slot="start" color="secondary" />
        <span>USE SUGGESTION</span>
      </ion-button>
    </ng-container>

    <ng-container *ngIf="view.suggestion === 'asking'">
      <p>Generating suggestion{{ thinking$ | async }}</p>
    </ng-container>

    <ng-container *ngIf="view.suggestion === 'error'">
      <p>Something went wrong while generating a suggestion.</p>
    </ng-container>

    <ng-container *ngIf="view.suggestion !== 'asking' && view.suggestion !== 'error'">
      <article>{{ view.suggestion }}</article>
    </ng-container>

    <section *ngIf="questions.length && (view.suggestions.length || (view.suggestion !== 'asking' && view.suggestion !== 'error'))">
      <p>Improve the suggestions by answering the following questions</p>
      <ion-list mode="md">
        <ng-container *ngFor="let question of questions; let last = last; let index = index">
          <ion-item lines="none">
            <ion-label color="secondary">
              <small>{{ question.question }}</small>
            </ion-label>
          </ion-item>
          <ion-item [lines]="last ? 'none' : 'full'">
            <ion-input
              [(ngModel)]="questions[index].answer"
              type="text"
              maxlength="222"
            ></ion-input>
          </ion-item>
        </ng-container>
      </ion-list>
      <ion-button class="secondary" (click)="submit()">Submit</ion-button>
    </section>

  </ng-container>
</main>
