<strive-header title="Bucket List"></strive-header>

<ng-container *ngIf="user.uid !== undefined else loading">
  <ng-container *ngIf="!!user.uid else notLoggedIn">
    <ion-content class="ion-no-padding">

      <!-- Goals -->
      <section fxLayout="column">
        <article fxLayout fxLayoutAlign="space-between end" fxLayoutGap="8px">
          <h2>Bucket List</h2>
          <ion-button fill="clear" (click)="createGoal()">
            <ion-icon name="add" slot="start"></ion-icon>
            <span>add goal</span>
          </ion-button>
        </article>

        <ng-container *ngIf="achievingGoals$ | async as achievingGoals; else loading">
          <ng-container *ngIf="achievingGoals.length > 0 else noBucketList">
            <ion-list class="md">
              <ng-container *ngFor="let value of achievingGoals; let last = last">
                <ion-item [lines]="last ? 'none' : 'inset'" button [routerLink]="['/goal/', value.goal.id]">
                  <ion-thumbnail slot="start" [ngClass]="{'gradient-border': value.stakeholder.status === 'active'}">
                    <img [ref]="value.goal.image" asset="goal.jpeg"/>
                    <div *ngIf="value.stakeholder.status === 'finished'">finished</div>
                  </ion-thumbnail>
                  <article>
                    <ion-label fxLayout="column">
                      <b>{{ value.goal.title }}</b>
                      <small fxLayout fxLayoutGap="4px">
                        <ion-icon name="pulse"></ion-icon><span>{{ value.stakeholder.status | status }}</span>
                        <ion-icon name="flag-outline"></ion-icon><span>{{ value.goal.numberOfAchievers }} Achiever{value.goal.numberOfAchievers, plural, =1 {} other {s}}</span>
                      </small>
                    </ion-label>
                    <ion-button fill="clear" (click)="openGoalOptions(value.goal, value.stakeholder, $event)">
                      <ion-icon slot="icon-only" name="ellipsis-vertical"></ion-icon>
                    </ion-button>
                  </article>
                </ion-item>
              </ng-container>
            </ion-list>
          </ng-container>
          <ng-template #noBucketList>
            <span class="padding">No goals yet. Create your first.</span>
          </ng-template>
        </ng-container>
      </section>

    </ion-content>
  </ng-container>
</ng-container>


<ng-template #notLoggedIn>
  <section class="not-logged-in">
    <p>
        <span class="fat-text-button" (click)="openAuthModal()">Log in</span>to view your goals
    </p>
  </section>
</ng-template>

<ng-template #loading>
  <strive-page-loading></strive-page-loading>
</ng-template>