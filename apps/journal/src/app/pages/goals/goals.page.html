<strive-header-root [title]="user.uid ? 'Goals' : 'Home'"></strive-header-root>

<ng-container *ngIf="(user.uid$ | async) !== undefined else loading">
  <ng-container *ngIf="!!user.uid else notLoggedIn">
    <ion-content class="ion-padding">

      <!-- Goals -->
      <main>
        <header>
          <h2>Goals</h2>
          <ion-button fill="clear" (click)="createGoal()">
            <ion-icon name="add" slot="start"></ion-icon>
            <span>add goal</span>
          </ion-button>
        </header>

        <ng-container *ngIf="achievingGoals$ | async as achievingGoals; else loading">
          <ng-container *ngIf="achievingGoals.length > 0 else noGoals">

            <section>
              <ng-container *ngFor="let value of achievingGoals">
                <ion-card [routerLink]="['/goal/', value.goal.id]">
                  <ion-item lines="none">
                    <ion-thumbnail slot="start" [ngClass]="{'gradient-border': value.stakeholder.status === 'active'}">
                      <img [ref]="value.goal.image" asset="goal.jpeg"/>
                      <div *ngIf="value.stakeholder.status === 'finished'">finished</div>
                    </ion-thumbnail>
                    <article>
                      <ion-text>
                        <b>{{ value.goal.title }}</b>
                        <small fxLayout fxLayoutGap="4px">
                          <ion-icon name="pulse"></ion-icon><span>{{ value.stakeholder.status | status }}</span>
                          <ion-icon name="flag-outline"></ion-icon><span>{{ value.goal.numberOfAchievers }} Achiever{value.goal.numberOfAchievers, plural, =1 {} other {s}}</span>
                        </small>
                      </ion-text>
                      <ion-button fill="clear" (click)="openGoalOptions(value.goal, value.stakeholder, $event)">
                        <ion-icon slot="icon-only" name="ellipsis-vertical"></ion-icon>
                      </ion-button>
                    </article>
                  </ion-item>
                  <ul *ngIf="value.events.length">
                    <li *ngFor="let event of value.events">
                      <ion-icon [name]="event.icon"></ion-icon>
                      <span [ngClass]="{'important': event.important}">{{ event.message }}</span>
                    </li>
                  </ul>
                </ion-card>
              </ng-container>
            </section>

          </ng-container>
          <ng-template #noGoals>
            <span class="padding">No goals yet. Create your first.</span>
          </ng-template>
        </ng-container>

      </main>
    </ion-content>
  </ng-container>
</ng-container>


<ng-template #notLoggedIn>
  <journal-home></journal-home>
</ng-template>

<ng-template #loading>
  <strive-page-loading></strive-page-loading>
</ng-template>