<strive-header-root [title]="user.uid ? 'Goals' : ''"></strive-header-root>

<ng-container *ngIf="(user.uid$ | async) !== undefined else loading">
  <ng-container *ngIf="!!user.uid else notLoggedIn">
    <ion-content class="ion-padding">

      <ion-refresher slot="fixed" (ionRefresh)="refresh($event)">
        <ion-refresher-content></ion-refresher-content>
      </ion-refresher>

      <main>
        <ng-container *ngIf="achieving$ | async as stakeholders">
          <section *ngIf="stakeholders.length" class="thumbs">
            <ng-container *ngFor="let stakeholder of stakeholders">
              <article (click)="openAllModal(stakeholder)">
                <ion-thumbnail>
                  <img [ref]="stakeholder.goal.image" asset="goal.png"/>
                </ion-thumbnail>
                <small>{{ stakeholder.goal.title }}</small>
                <ion-badge color="primary">{{ stakeholder.events.length }}</ion-badge>
              </article>
            </ng-container>
            <article *ngIf="seeAll | async" (click)="openAllModal()">
              <ion-button fill="clear">
                <ion-icon slot="icon-only" name="arrow-forward-outline"></ion-icon>
              </ion-button>
              <small>See all</small>
            </article>
          </section>
        </ng-container>

        <ng-container *ngIf="stakeholders$ | async as stakeholders; else loading">
          <ng-container *ngIf="stakeholders.length else noGoals">

            <ion-button fill="clear" (click)="createGoal()" class="cards-header">
              <ion-icon name="add" slot="start"></ion-icon>
              <span>add goal</span>
            </ion-button>

            <section class="cards">
              <ng-container *ngFor="let stakeholder of stakeholders; trackBy: trackByFn">
                <goal-thumbnail [goal]="stakeholder.goal" [stakeholder]="stakeholder" [events]="stakeholder.events" [routerLink]="['/goal/', stakeholder.goal.id]">
                  <small *ngIf="stakeholder.goal.publicity === 'private'">
                    <ion-icon name="lock-closed-outline"></ion-icon>
                    <span>Private</span>
                  </small>
                </goal-thumbnail>
              </ng-container>
            </section>

          </ng-container>

          <ng-template #noGoals>
            <header>
              <ion-button fill="clear" (click)="createGoal()">
                <ion-icon name="add" slot="start"></ion-icon>
                <span>add goal</span>
              </ion-button>      
            </header>
            <span class="padding">No goals yet. Create your first.</span>
          </ng-template>
        </ng-container>

      </main>
    </ion-content>
  </ng-container>
</ng-container>

<ng-template #notLoggedIn>
  <journal-home></journal-home>
</ng-template>

<ng-template #loading>
  <strive-page-loading></strive-page-loading>
</ng-template>