<strive-header title="Supports"></strive-header>

<ng-container *ngIf="user.uid === undefined">
  <strive-page-loading></strive-page-loading>
</ng-container>

<ng-container *ngIf="user.uid === ''">
  <div class="not-logged-in">
    <p>
      <span class="fat-text-button" (click)="openAuthModal()">Log in</span>to view your supports
    </p>
  </div>  
</ng-container>

<ion-content class="ion-padding" *ngIf="!!user.uid">
  <section>

    <h2>Goals you support</h2>
    <ion-list mode="md">
      <ng-container *ngIf="supportsOpen$ | async as supports">
        <ng-container *ngIf="supports.length else notSupportingGoals">
          <ng-container *ngFor="let support of supports; let last = last">
            <ion-item [lines]="last ? 'none' : 'inset'">
              <ion-label class="ion-text-wrap">
                <ion-text>{{ support.description }}</ion-text>
                <ng-template [ngTemplateOutlet]="path" [ngTemplateOutletContext]="{ $implicit: support }"></ng-template>
              </ion-label>
              <ion-button fill="clear" (click)="openOptions(support, $event)">
                <ion-icon slot="icon-only" name="ellipsis-vertical"></ion-icon>
              </ion-button>
            </ion-item>
          </ng-container>
        </ng-container>
        <ng-template #notSupportingGoals>
          <ion-item>Not supporting any goals yet</ion-item>
        </ng-template>
      </ng-container>
    </ion-list>
      
    <h2>Support to get</h2>
    <ion-list mode="md">
      <ng-container *ngIf="supportsToGet$ | async as supports">
        <ng-container *ngIf="supports.length else noSupportsToGet">
          <ng-container *ngFor="let support of supports; let last = last">
            <ion-item [lines]="last ? 'none' : 'inset'">
              <ion-label>
                <ion-text>
                  {{ support.description }} from {{ support.supporter.username }}
                </ion-text>
                <ng-template [ngTemplateOutlet]="path" [ngTemplateOutletContext]="{ $implicit: support }">
                </ng-template>
              </ion-label>
              <ion-button fill="outline" slot="end" (click)="supportPaid(support)">Got it</ion-button>
            </ion-item>
          </ng-container>
        </ng-container>
        <ng-template #noSupportsToGet>
          <ion-item lines="none">-</ion-item>
        </ng-template>
      </ng-container>
    </ion-list>

    <h2>Supports to give</h2>
    <ion-list mode="md">
      <ng-container *ngIf="supportsToGive$ | async as supports">
        <ng-container *ngIf="supports.length else noSupportsToGive">
          <ng-container *ngFor="let support of supports; let last = last">
            <ion-item [lines]="last ? 'none' : 'inset'">
              <ion-label>
                <ion-text>
                  {{ support.description }} to achiever(s) from {{ support.goal.title }}
                </ion-text>
                <ng-template [ngTemplateOutlet]="path" [ngTemplateOutletContext]="{ $implicit: support }">
                </ng-template>
              </ion-label>
              <ion-button fill="outline" slot="end" (click)="supportPaid(support)">Gave it</ion-button>
            </ion-item>
          </ng-container>
        </ng-container>
        <ng-template #noSupportsToGive>
          <ion-item lines="none">-</ion-item>
        </ng-template>
      </ng-container>
    </ion-list>

    <h2>Supports gotten</h2>
    <ion-list mode="md">
      <ng-container *ngIf="supportsGotten$ | async as supports">
        <ng-container *ngIf="supports.length else noSupportsGotten">
          <ng-container *ngFor="let support of supports; let last = last">
            <ion-item [lines]="last ? 'none' : 'inset'">
              <ion-label>
                <ion-text>
                  {{ support.description }} to achiever(s) from {{ support.goal.title }}
                </ion-text>
                <ng-template [ngTemplateOutlet]="path" [ngTemplateOutletContext]="{ $implicit: support }">
                </ng-template>
              </ion-label>
            </ion-item>
          </ng-container>
        </ng-container>
        <ng-template #noSupportsGotten>
          <ion-item lines="none">-</ion-item>
        </ng-template>
      </ng-container>
    </ion-list>

    <h2>Supports given</h2>
    <ion-list mode="md">
      <ng-container *ngIf="supportsGiven$ | async as supports">
        <ng-container *ngIf="supports.length else noSupportsGiven">
          <ng-container *ngFor="let support of supports; let last = last">
            <ion-item [lines]="last ? 'none' : 'inset'">
              <ion-label>
                <ion-text>
                  {{ support.description }} to achiever(s) from {{ support.goal.title }}
                </ion-text>
                <ng-template [ngTemplateOutlet]="path" [ngTemplateOutletContext]="{ $implicit: support }">
                </ng-template>
              </ion-label>
            </ion-item>
          </ng-container>
        </ng-container>
        <ng-template #noSupportsGiven>
          <ion-item lines="none">-</ion-item>
        </ng-template>
      </ng-container>
    </ion-list>

  </section>
</ion-content>

<ng-template #path let-support>
  <ion-text>
    <p *ngIf="!support.milestone.id"><a [routerLink]="'../goal/' + (support.goal.id)">{{ support.goal.title }}</a></p>
    <p *ngIf="support.milestone.id"><a [routerLink]="'../goal/' + (support.goal.id)">{{ support.goal.title | mSlice}}</a>&nbsp;<span class="arrow">&#8702;</span> {{ support.milestone.content | mSlice }}</p>
  </ion-text>
</ng-template>