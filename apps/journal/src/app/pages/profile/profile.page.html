<ng-container *ngIf="title$ | async as title">

  <ng-container *ngIf="isOwner$ | async else notOwner">
    <strive-header-root [title]="title"></strive-header-root>
  </ng-container>
  <ng-template #notOwner>
    <strive-header [title]="title"></strive-header>
  </ng-template>

</ng-container>

<ion-content class="ion-no-padding">
  <ng-template #loading>
    <ng-container *ngIf="!!profileId else login">
      <strive-page-loading></strive-page-loading>
    </ng-container>

    <ng-template #login>
      <section class="not-logged-in">
        <p>
            <span class="fat-text-button" (click)="openAuthModal()">Log in</span>to view your profile
        </p>
      </section>
   </ng-template>
  </ng-template>

  <ng-container *ngIf="profile$ | async as profile; else loading">
    <main>
      <header>
        <ion-card class="ion-padding">
          <article class="profile">
            <ion-avatar>
              <img [ref]="profile.photoURL" asset="profile.png" alt="profile picture" (click)="editProfileImage(profile, $event)"/>
            </ion-avatar>
            <div>
              <h5>{{ profile.username }}</h5>
              <span>Joined {{ profile.createdAt | date:'longDate' }}</span>
            </div>
          </article>
          <ul>
            <li (click)="openFollowers()" class="clickable">
              <span class="number">{{ profile.numberOfSpectators }}</span>
              <span>Followers</span>
            </li>
            <li (click)="openFollowing()" class="clickable">
              <span class="number">{{ profile.numberOfSpectating }}</span>
              <span>Following</span>
            </li>
            <li (click)="openSupporting()" class="clickable">
              <span class="number">{{ (supportingGoals$ | async)?.length ?? 0 }}</span>
              <span>Goals supported</span>
            </li>
          </ul>
        </ion-card>

        <ng-container *ngIf="(isOwner$ | async) === false">
          <ng-container *ngIf="isSpectator$ | async else notSpectator">
            <ion-button (click)="toggleSpectate(false)" size="block" class="fake-disable">
              <ion-icon name="star" slot="start"></ion-icon>
              <span>FOLLOWING</span>
            </ion-button>
          </ng-container>
          <ng-template #notSpectator>
            <ion-button (click)="toggleSpectate(true)" size="block">
              <ion-icon name="star-outline" slot="start"></ion-icon>
              <span>FOLLOW</span>
            </ion-button>
          </ng-template>
        </ng-container>
      </header>

      <section class="goals">
        <article fxLayout fxLayoutAlign="space-between end" fxLayoutGap="8px">
          <h2>Goals</h2>
          <ion-button *ngIf="isOwner$ | async" fill="clear" (click)="createGoal()">
            <ion-icon name="add" slot="start"></ion-icon>
            <span>add goal</span>
          </ion-button>
        </article>
        <ng-container *ngIf="achievingGoals$ | async as achievingGoals">
          <ng-container *ngIf="achievingGoals.length > 0 else noBucketList">
            <ul>
              <li *ngFor="let value of achievingGoals">
                <goal-thumbnail [goal]="value.goal" [stakeholder]="(isOwner$ | async) ? value.stakeholder : undefined" [routerLink]="['/goal/', value.goal.id]">
                  <div>
                    <small *ngIf="value.goal.publicity === 'private'">
                      <ion-icon name="lock-closed-outline"></ion-icon>
                      <span>Private</span>
                    </small>
                    <small>
                      <ion-icon name="flag-outline"></ion-icon>
                      <span>{{ value.goal.numberOfAchievers }} Achiever{value.goal.numberOfAchievers, plural, =1 {} other {s}}</span>
                    </small>
                  </div>
                </goal-thumbnail>
              </li>
            </ul>

          </ng-container>
          <ng-template #noBucketList>
            <span>Not achieving any goals</span>
          </ng-template>
        </ng-container>
      </section>

    </main>
  </ng-container>
</ion-content>