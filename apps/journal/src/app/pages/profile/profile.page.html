<ion-header *ngIf="platform.is('android') || platform.is('ios')">
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <!-- <ion-menu-button *ngIf="!_platform.is('android') && !_platform.is('ios')"></ion-menu-button> -->
      <ion-back-button></ion-back-button>
    </ion-buttons>
    <ion-title>{{ shouldLogin ? 'Profile' : (profile$ | async).username }}</ion-title>
    <ng-container *ngIf="isOwner">
      <ion-buttons slot="end">
        <ion-button (click)="presentProfileOptionsPopover($event)">
          <ion-icon slot="icon-only" name="settings"></ion-icon>
        </ion-button>
      </ion-buttons>
    </ng-container>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ng-template #loading>
    <ng-container *ngIf="!shouldLogin else login">
      <strive-page-loading></strive-page-loading>
    </ng-container>

    <ng-template #login>
      <section fxLayout fxLayoutAlign="center center">
        <span><b (click)="openAuthModal()">Log in</b> to view your profile</span>
      </section>
   </ng-template>
  </ng-template>

  <ng-container *ngIf="!!profile; else loading">
    <section fxLayout="column" class="header">

      <!-- HEADER -->
      <ion-card>
        <article fxLayout fxLayoutAlign="center end">
          <img [src]="_chosenPicture || profile.photoURL || 'assets/img/avatar/blank-profile-picture_256_thumb.png'" (click)="editProfileImage($event)">
          <ion-icon *ngIf="isOwner" name="create" (click)="editProfileImage($event)"></ion-icon>
        </article>
        <article fxLayout fxLayoutAlign="center center">
          <ng-container *ngIf="isOwner else username">
            <ion-input type="text" 
              [ngStyle]="{'max-width': profileForm.username.value ? profileForm.username.value.length + 1.5 + 'ch' : '1.5ch'}" 
              [formControl]="profileForm.username" 
              (keydown.enter)="updateUsername()">
            </ion-input>
            <ion-icon [name]="profileForm.enabled ? 'save' : 'create'" (click)="updateUsername()"></ion-icon>
          </ng-container>
          <ng-template #username>
            <h4>{{ profile.username }}</h4>
          </ng-template>
        </article>
        <article fxLayout fxLayoutAlign="space-evenly">
          <div fxLayout="column" fxLayoutAlign="center center">
            <p>Followers</p>
            <span>{{ profile.numberOfSpectators }}</span>
          </div>
          <div fxLayout="column" fxLayoutAlign="center center">
            <p>Following</p>
            <span>{{ profile.numberOfSpectating }}</span>
          </div>
        </article>

        <ng-container *ngIf="!isOwner">
          <ion-button (click)="toggleSpectate()" fill="outline">{{ isSpectator ? 'Stop Following' : 'Follow' }}</ion-button>
        </ng-container>
      </ion-card>

    </section>
  </ng-container>

    <!-- <div *ngSwitchCase="'info'"> -->
      <div class="vertical-align-content">

        <!-- Affirmations -->
        <div class="exercise" *ngIf="_affirmations as affirmations">  
          <div *ngIf="affirmations?.affirmations?.length > 0">
            <div class="exercise-header-container">
              <h3 class="padding">Affirmations</h3>
              <ion-icon class="exercise-edit-icon" *ngIf="isOwner" name="create" (click)="openExercise(enumExercises.affirmations)"></ion-icon>
            </div>
            <ion-list>
              <div *ngFor="let affirmation of affirmations.affirmations">
                <ion-item>
                  <ion-label>{{ affirmation }}</ion-label>
                </ion-item>
              </div>
            </ion-list>
          </div>
        </div>

        <!-- Bucket List -->
        <exercise-bucket-list-view [uid]="profileId" [isOwner]="isOwner" [isSpectator]="isSpectator"></exercise-bucket-list-view>

      </div>

      <!-- Achieving Goals overview -->
      <h3 class="padding">Achieving Goals</h3>

      <ng-container *ngIf="achievingGoals$ | async as achievingGoals">
        <ng-container *ngIf="achievingGoals.length > 0 else noAchievingGoals">

          <thumbnail-list type="goal">
            <ng-container *ngFor="let goal of achievingGoals$ | async">
              <ng-template #thumb>
                <rectangle-thumbnail type="goal" [image]="goal.image" [routerLink]="['/goal', goal.id]">
                  <ng-template #thumbTitle>
                    {{ goal.title }}
                  </ng-template>
                </rectangle-thumbnail>
              </ng-template>
            </ng-container>
          </thumbnail-list>
            
        </ng-container>
        <ng-template #noAchievingGoals>
          <span class="padding">Not achieving any goals</span>
        </ng-template>
      </ng-container>

      <!-- Supporting Goals overview -->
      <h3 class="padding">Supporting Goals</h3>

      <ng-container *ngIf="supportingGoals$ | async as supportingGoals">
        <ng-container *ngIf="supportingGoals.length > 0 else noSupportingGoals">

          <thumbnail-list type="goal">
            <ng-container *ngFor="let goal of supportingGoals$ | async">
              <ng-template #thumb>
                <rectangle-thumbnail type="goal" [image]="goal.image" [routerLink]="['/goal', goal.id]">
                  <ng-template #thumbTitle>
                    {{ goal.title }}
                  </ng-template>
                </rectangle-thumbnail>
              </ng-template>
            </ng-container>
          </thumbnail-list>

        </ng-container>
        <ng-template #noSupportingGoals>
          <span class="padding">Not supporting any goals</span>
        </ng-template>
      </ng-container>


      <div class="exercise-wrapper" *ngIf="isOwner">
        <h3 class="padding">Exercises</h3>
        <ion-grid>
          <ion-row>
              <ion-card class="exercise-card ion-no-padding" (click)="openExercise(enumExercises.affirmations)" >
      
                <img src="assets\exercises\affirmations\affirmations2.jpg"/>
                <div class="card-title">Affirmations</div>
        
              </ion-card>
        
              <!-- <ion-card class="exercise-card ion-no-padding" (click)="openExercise(enumExercises.bucketlist)" *ngIf="!(bucketList$ | async)?.items">
              
                <img src="assets\exercises\bucketlist\bucketlist2.jpg"/>
                <div class="card-title">Bucket List</div>
        
              </ion-card> -->
        
              <ion-card class="exercise-card ion-no-padding" (click)="openExercise(enumExercises.dear_future_self)">
              
                <img src="assets\exercises\dear_future_self\dear_future_self2.jpg"/>
                <div class="card-title">Dear Future Self</div>
        
              </ion-card>
        
              <ion-card class="exercise-card ion-no-padding" (click)="openExercise(enumExercises.daily_gratefulness)">
              
                <img src="assets\exercises\daily_gratefulness\daily_gratefulness2.jpg"/>
                <div class="card-title">Daily Gratefulness</div>
        
              </ion-card>
        
              <ion-card class="exercise-card ion-no-padding" (click)="openExercise(enumExercises.assess_life)">
              
                <img src="assets\exercises\assess_life\assess_life_man2.jpg"/>
                <div class="card-title">Assess Life</div>
        
              </ion-card>
          </ion-row>        
        </ion-grid>
      </div>

      <!-- Only owner can go into edit mode -->
      <!-- <ion-fab *ngIf="_isOwner && _inEditMode" vertical="bottom" horizontal="end" slot="fixed"> -->
        <!-- <ion-fab-button *ngIf="!_inEditMode" (click)="toggleEdit()"><ion-icon name="build"></ion-icon></ion-fab-button> -->
        <!-- <ion-fab-button *ngIf="_inEditMode" (click)="toggleEdit()"><ion-icon name="send"></ion-icon></ion-fab-button> -->
      <!-- </ion-fab> -->

    <!-- </div>
    <div *ngSwitchCase="'spectators'" class="vertical-align-content"> -->
      <!-- <span class="back-btn" (click)="segmentChanged('info')"><ion-icon name="arrow-back"></ion-icon>back</span>

      <h3 class="padding">Followers</h3>
      <ion-list>
        <ion-item *ngFor="let spectator of spectators" button [routerLink]="'../' + (spectator.id)">
          {{ spectator.username }}
        </ion-item>
      </ion-list> -->

    <!-- </div>

    <div *ngSwitchCase="'spectating'" class="vertical-align-content"> -->
      <!-- <span class="back-btn" (click)="segmentChanged('info')"><ion-icon name="arrow-back"></ion-icon>back</span>

      <h3 class="padding">Following</h3>
      <ion-list>
        <ion-item *ngFor="let spectating of spectating"  button [routerLink]="'../' + (spectating.id)">
          {{ spectating.profileUsername }}
        </ion-item>
      </ion-list> -->

    <!-- </div> -->
  </ion-content>  