<strive-header-root title="Feed"></strive-header-root>

<ng-container *ngIf="user.uid !== undefined else loading">
  <ng-container *ngIf="!!user.uid; else notLoggedIn">
    <ng-container *ngIf="notifications$ | async as notifications; else loading">

      <ion-content>
        <ion-refresher slot="fixed" (ionRefresh)="refresh($event)">
          <ion-refresher-content></ion-refresher-content>
        </ion-refresher>
      
        <ng-container *ngIf="notifications.length else empty">
          <section fxLayout="column" fxLayoutAlign="center start">

            <ng-container *ngFor="let notification of decisions$ | async; let isLast = last">
              <notification-main [notification]="notification" isAdmin="true" [reference]="'Users/' + user.uid + '/Notifications/' + notification.id"></notification-main>
              <span *ngIf="isLast" class="divider"></span>
            </ng-container>

            <ng-container *ngFor="let notification of notifications; let isLast = last">
              <ng-container *ngIf="!notification.needsDecision">
                <notification-main [notification]="notification" isAdmin="true" [reference]="'Users/' + user.uid + '/Notifications/' + notification.id"></notification-main>
                <span *ngIf="!isLast" class="divider"></span>
              </ng-container>
            </ng-container>

            <ion-infinite-scroll threshold="100px" (ionInfinite)="more($event)">
              <ion-infinite-scroll-content
                loadingSpinner="bubbles"
                loadingText="Loading more data...">
              </ion-infinite-scroll-content>
            </ion-infinite-scroll>

          </section>
        </ng-container>

        <ng-template #empty>
          <section fxLayout="column" fxLayoutAlign="center center" fxLayoutGap="16px" class="empty">
            <article>Nothing to show yet</article>
            <article><span class="fat-text-button" routerLink="/goals">Create</span>a goal</article>
            <article><span class="fat-text-button" routerLink="/explore">Find</span>friends</article>
            <article><span class="fat-text-button" routerLink="/explore">Explore</span>goals</article>
          </section>
        </ng-template>
      </ion-content>

    </ng-container>
  </ng-container>
</ng-container>


<ng-template #loading>
  <strive-page-loading></strive-page-loading>
</ng-template>

<ng-template #notLoggedIn>
  <section class="not-logged-in">
    <p>
        <span class="fat-text-button" (click)="openAuthModal()">Log in</span>to view your feed
    </p>
  </section>
</ng-template>
  